# Roadmap 902: 컨테이너 빌드 (BuildKit)

## Status: Rejected

> BuildKit + Registry 통합은 제품 범위에서 제외

---

## 결정 이유

### 1. 책임 범위 문제

"개발부터 배포까지"를 약속하면 code-hub는 CDE가 아니라 **플랫폼 팀**이 된다.

- 빌드 권한 관리
- 이미지 취약점 스캔
- 레지스트리 운영 (용량, 정리, 접근 제어)
- 빌드 캐시 전략

→ 이 모든 것이 "제품 책임 범위"가 됨

### 2. 기존 도구와의 경쟁

| 도구 | 성숙도 | 커뮤니티 |
|------|--------|---------|
| GitHub Actions | 매우 높음 | 거대 |
| GitLab CI | 매우 높음 | 거대 |
| Jenkins | 높음 | 거대 |

→ 같은 걸 만들어도 "왜 이기냐"에 답이 없음

### 3. 핵심 가치 집중

code-hub의 핵심:
- 온프레미스 CDE
- 포트 포워딩으로 실시간 공유
- WARM/COLD로 비용 절감

빌드는 핵심 가치가 아님. 기존 CI/CD와 공존하는 것이 전략.

---

## 대안

```
워크스페이스 → git push → 기존 CI/CD (Actions, GitLab, Jenkins)
                              ↓
                         기존 Registry
```

---

## 핵심 메시지

> "말만 바꾸는 게 아니라, 책임 범위(약속)를 바꾸는 것.
> 같은 걸 만들더라도 '어디까지를 반드시 완벽하게' 해야 하는지 달라진다."

---

## 원본 내용 (참고용)

<details>
<summary>원래 계획했던 아키텍처</summary>

### 문제 상황

```
Workspace (code-server)
    ↓
docker build .  ← 실행 불가 (Docker 데몬 없음)
```

**원인**: Workspace Pod에서 Docker 데몬 접근 불가 (보안 + K8s 호환)

### 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│  Internal Network (code-hub)                                │
│                                                             │
│  Workspace Pod         BuildKit           Registry          │
│  ┌───────────┐        ┌─────────┐        ┌─────────┐       │
│  │code-server│──build─▶│BuildKit │──push─▶│Registry │       │
│  │           │   요청  │ (원격)  │        │ (v2)    │       │
│  └───────────┘        └─────────┘        └────┬────┘       │
│       │                                       │             │
│       │              ┌─────────┐              │             │
│       └────pull─────▶│  MinIO  │◀────storage──┘             │
│                      │(backend)│                            │
│                      └─────────┘                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 핵심 구성 요소

| 구성 요소 | 역할 | 기술 |
|----------|------|------|
| **BuildKit** | 데몬리스 이미지 빌드 | moby/buildkit |
| **Registry** | 이미지 저장소 | Docker Registry v2 |
| **MinIO** | Registry 백엔드 스토리지 | S3 호환 |

</details>

---

## References

- 피드백: "같은 걸 만들더라도 '어디까지를 반드시 완벽하게' 해야 하는지 달라진다"
