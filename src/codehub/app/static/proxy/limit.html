<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Limit Exceeded - CodeHub</title>
  <link rel="stylesheet" href="/static/css/theme.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            vscode: {
              bg: '#1e1e1e',
              sidebar: '#252526',
              hover: '#2a2d2e',
              border: '#3c3c3c',
              text: '#cccccc',
              accent: '#007acc',
              success: '#89d185',
              warning: '#cca700',
              error: '#f14c4c',
            }
          }
        }
      }
    }
  </script>
</head>
<body class="bg-vscode-bg text-vscode-text min-h-screen flex items-center justify-center">
  <div class="text-center px-4 max-w-md">
    <div class="text-5xl mb-4">⚠️</div>
    <h1 class="text-xl font-semibold text-white mb-2">Running Limit Exceeded</h1>
    <p class="text-sm mb-4">
      You can run up to <span id="max-running" class="text-vscode-error font-semibold"></span> workspaces at a time.
    </p>
    <p class="text-sm mb-6">Stop one of the running workspaces to start a new one.</p>

    <div id="running-list" class="bg-vscode-sidebar border border-vscode-border rounded-lg p-4 mb-6 text-left">
      <h3 class="text-xs text-vscode-text mb-3">Currently Running</h3>
      <ul id="workspace-list" class="space-y-2"></ul>
    </div>

    <a href="/" class="inline-block bg-vscode-accent hover:bg-blue-600 text-white px-6 py-2 rounded font-medium transition-colors">
      Go to Dashboard
    </a>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const maxRunning = params.get('max') || '2';
    const workspacesParam = params.get('workspaces') || '';

    document.getElementById('max-running').textContent = maxRunning;

    // Parse workspaces: id1:name1,id2:name2
    const listEl = document.getElementById('workspace-list');
    if (workspacesParam) {
      const workspaces = workspacesParam.split(',').map(w => {
        const [id, name] = w.split(':');
        return { id, name: decodeURIComponent(name || 'Workspace') };
      });

      workspaces.forEach(ws => {
        const li = document.createElement('li');
        li.className = 'flex justify-between items-center';
        li.innerHTML = `
          <span class="text-white truncate">${ws.name}</span>
          <a href="/w/${ws.id}/" class="text-vscode-accent text-sm hover:underline">Open</a>
        `;
        listEl.appendChild(li);
      });
    }
  </script>
</body>
</html>
